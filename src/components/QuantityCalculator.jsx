import React, { useState, useRef } from 'react';
import { Calculator, ChevronDown, ChevronUp, Plus, Edit3, Trash2, Check, Save, Settings, Layers, Printer, Image, FileText, X } from 'lucide-react';

const QuantityCalculator = () => {
  const [mainTab, setMainTab] = useState('calculator');
  const [showReport, setShowReport] = useState(false);
  const c = { bg: '#0a0a0f', card: '#101018', cardAlt: '#1a1a28', border: '#252538', text: '#f0f0f8', muted: '#707088', accent: '#00d4ff', accentGradient: 'linear-gradient(135deg, #0099bb, #00d4ff)', accentGlow: '0 0 20px #00d4ff40', success: '#4ade80', warning: '#fbbf24', danger: '#f87171', info: '#22d3ee' };

  const [workItems, setWorkItems] = useState({
    tiles: { name: 'Ø§Ù„Ø¨Ù„Ø§Ø·', icon: 'ğŸ”²', items: [
      { id: 't1', name: 'Ø¥Ø²Ø§Ù„Ø© Ù…ØªÙˆØ³Ø·Ø©', desc: 'Ø¥Ø²Ø§Ù„Ø© Ø¨Ù„Ø§Ø· Ù‚Ø¯ÙŠÙ… Ù…ØªÙˆØ³Ø·', exec: 13, cont: 8, type: 'floor' },
      { id: 't2', name: 'Ø¥Ø²Ø§Ù„Ø© ÙƒØ¨ÙŠØ±Ø©', desc: 'Ø¥Ø²Ø§Ù„Ø© Ø¨Ù„Ø§Ø· ÙƒØ¨ÙŠØ±', exec: 20, cont: 12, type: 'floor' },
      { id: 't3', name: 'ØµØ¨Ø© Ø´Ø§Ù…Ù„ Ù…ÙˆØ§Ø¯', desc: 'ØµØ¨ Ø£Ø±Ø¶ÙŠØ© Ù…Ø¹ Ø§Ù„Ù…ÙˆØ§Ø¯', exec: 47, cont: 35, type: 'floor' },
      { id: 't4', name: 'ØªØ¨Ù„ÙŠØ· Ù…ØªÙˆØ³Ø·', desc: 'Ø¨Ù„Ø§Ø· 40Ã—40', exec: 28, cont: 18, type: 'floor' },
      { id: 't5', name: 'ØªØ¨Ù„ÙŠØ· ÙƒØ¨ÙŠØ±', desc: 'Ø¨Ù„Ø§Ø· 60Ã—60', exec: 33, cont: 22, type: 'floor' },
    ]},
    paint: { name: 'Ø§Ù„Ø¯Ù‡Ø§Ù†Ø§Øª', icon: 'ğŸ¨', items: [
      { id: 'p1', name: 'Ø¯Ø§Ø®Ù„ÙŠ Ø¬ÙˆØªÙ†', desc: 'Ø¯Ù‡Ø§Ù† Ø¬ÙˆØªÙ†', exec: 21, cont: 14, type: 'wall' },
      { id: 'p2', name: 'Ø¯Ø§Ø®Ù„ÙŠ Ø§Ù„Ø¬Ø²ÙŠØ±Ø©', desc: 'Ø¯Ù‡Ø§Ù† Ø§Ù„Ø¬Ø²ÙŠØ±Ø©', exec: 20, cont: 13, type: 'wall' },
      { id: 'p3', name: 'Ø®Ø§Ø±Ø¬ÙŠ Ø¬ÙˆØªÙ†', desc: 'Ø¯Ù‡Ø§Ù† Ø®Ø§Ø±Ø¬ÙŠ', exec: 23, cont: 15, type: 'wall' },
      { id: 'p4', name: 'Ù…Ø¹Ø¬ÙˆÙ†', desc: 'Ù…Ø¹Ø¬ÙˆÙ† ÙˆØªØ¬Ù‡ÙŠØ²', exec: 15, cont: 10, type: 'wall' },
    ]},
    gypsum: { name: 'Ø§Ù„Ø¬Ø¨Ø³', icon: 'ğŸ›ï¸', items: [
      { id: 'g1', name: 'Ø¬Ø¨Ø³Ù…Ø¨ÙˆØ±Ø¯', desc: 'ØªØ±ÙƒÙŠØ¨ Ø¬Ø¨Ø³Ù…Ø¨ÙˆØ±Ø¯', exec: 60, cont: 40, type: 'ceiling' },
      { id: 'g2', name: 'Ø¬Ø¨Ø³ Ø¨Ù„Ø¯ÙŠ', desc: 'Ø¬Ø¨Ø³ ØªÙ‚Ù„ÙŠØ¯ÙŠ', exec: 53, cont: 35, type: 'ceiling' },
    ]},
    electrical: { name: 'Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡', icon: 'âš¡', items: [
      { id: 'e1', name: 'ØªØ£Ø³ÙŠØ³ Ø´Ø§Ù…Ù„', desc: 'ØªØ£Ø³ÙŠØ³ ÙƒØ§Ù…Ù„', exec: 45, cont: 30, type: 'floor' },
      { id: 'e2', name: 'ØªØ´Ø·ÙŠØ¨', desc: 'ØªØ´Ø·ÙŠØ¨ ÙƒÙ‡Ø±Ø¨Ø§Ø¡', exec: 25, cont: 18, type: 'floor' },
    ]},
    plumbing: { name: 'Ø§Ù„Ø³Ø¨Ø§ÙƒØ©', icon: 'ğŸ”§', items: [
      { id: 'pb1', name: 'ØªØ£Ø³ÙŠØ³ Ø´Ø§Ù…Ù„', desc: 'ØªØ£Ø³ÙŠØ³ Ø³Ø¨Ø§ÙƒØ©', exec: 80, cont: 55, type: 'floor' },
      { id: 'pb2', name: 'ØªØ´Ø·ÙŠØ¨', desc: 'ØªØ´Ø·ÙŠØ¨ Ø³Ø¨Ø§ÙƒØ©', exec: 40, cont: 28, type: 'floor' },
    ]},
  });

  const [places, setPlaces] = useState({ dry: { name: 'Ø¬Ø§Ù', icon: 'ğŸ ', color: c.accent, enabled: true }, wet: { name: 'Ø±Ø·Ø¨', icon: 'ğŸš¿', color: c.info, enabled: true }, outdoor: { name: 'Ø®Ø§Ø±Ø¬ÙŠ', icon: 'ğŸŒ³', color: c.success, enabled: true } });
  const [programming, setProgramming] = useState({ dry: { tiles: ['t1','t2','t3','t4','t5'], paint: ['p1','p2','p4'], gypsum: ['g1','g2'], electrical: ['e1','e2'] }, wet: { tiles: ['t1','t2','t3','t4','t5'], paint: ['p1','p2','p4'], gypsum: ['g1','g2'], electrical: ['e1','e2'], plumbing: ['pb1','pb2'] }, outdoor: { tiles: ['t1','t2','t3','t4','t5'], paint: ['p3'], electrical: ['e1','e2'], plumbing: ['pb1','pb2'] } });
  const calcPlaces = { dry: ['ØµØ§Ù„Ø©', 'Ù…Ø¬Ù„Ø³', 'ØºØ±ÙØ© Ù†ÙˆÙ… Ø±Ø¦ÙŠØ³ÙŠØ©', 'ØºØ±ÙØ© Ù†ÙˆÙ… 1', 'Ù…ÙƒØªØ¨'], wet: ['Ù…Ø·Ø¨Ø®', 'Ø¯ÙˆØ±Ø© Ù…ÙŠØ§Ù‡ Ø±Ø¦ÙŠØ³ÙŠØ©', 'Ø¯ÙˆØ±Ø© Ù…ÙŠØ§Ù‡ 1', 'ØºØ±ÙØ© ØºØ³ÙŠÙ„'], outdoor: ['Ø­ÙˆØ´ Ø£Ù…Ø§Ù…ÙŠ', 'Ø­ÙˆØ´ Ø®Ù„ÙÙŠ', 'Ø³Ø·Ø­', 'Ù…ÙˆÙ‚Ù'] };

  const [selectedPlaceType, setSelectedPlaceType] = useState('');
  const [selectedPlace, setSelectedPlace] = useState('');
  const [selectedItems, setSelectedItems] = useState([]);
  const [addedItems, setAddedItems] = useState({});
  const [inputMethod, setInputMethod] = useState('direct');
  const [area, setArea] = useState(0);
  const [length, setLength] = useState(0);
  const [width, setWidth] = useState(0);
  const [height, setHeight] = useState(3);
  const [expandedCategories, setExpandedCategories] = useState({ tiles: true });
  const [editingItem, setEditingItem] = useState(null);

  const [images, setImages] = useState({ logo: { src: null, width: 80, height: 60 }, stamp: { src: null, width: 60, height: 60 }, signature: { src: null, width: 100, height: 50 } });
  const [reportData, setReportData] = useState({ companyName: 'Ø±ÙƒØ§Ø¦Ø² Ø§Ù„Ø£ÙˆÙ„Ù‰', companySubtitle: 'Ù„Ù„ØªØ¹Ù…ÙŠØ±', headerTitle: 'ØªÙ‚Ø¯ÙŠØ± ØªÙƒÙ„ÙØ© Ù…Ø¨Ø¯Ø¦ÙŠ', quoteNumber: Math.floor(Math.random() * 100000000).toString(), quoteDate: new Date().toLocaleDateString('ar-SA'), contactPhone: '+96653 244 5054', clientName: '', clientPhone: '', clientLocation: '', projectTitle: 'Ù…Ø´Ø±ÙˆØ¹ ØªØ±Ù…ÙŠÙ… ÙˆØªØ´Ø·ÙŠØ¨', vatRate: 15, noteText: 'Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù…Ø­Ø³ÙˆØ¨Ø© Ø¨Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©', terms: ['Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ØªÙ‚Ø¯ÙŠØ±ÙŠØ©', 'ÙŠØ³Ø±ÙŠ Ø§Ù„Ø¹Ø±Ø¶ 15 ÙŠÙˆÙ…Ø§Ù‹', 'Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù…Ø© 50%'], bankName: 'Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ', accountNumber: '', iban: '', footerEmail: 'info@company.com' });
  const [freeItems, setFreeItems] = useState([{ id: 'F1', title: 'Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø§Øª', desc: 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª', price: 'Ù…Ø¬Ø§Ù†Ø§Ù‹' }]);
  const [imageEditModal, setImageEditModal] = useState(null);

  const quickAreas = [5, 10, 15, 20, 25, 30, 40, 50];
  const calcFloorArea = () => length * width;
  const calcWallArea = () => 2 * (length + width) * height;
  const getArea = () => inputMethod === 'direct' ? area : calcFloorArea();
  const getWallArea = () => inputMethod === 'dimensions' ? calcWallArea() : 0;
  const adjustValue = (setter, value, delta, min = 0) => { const nv = Math.max(min, value + delta); setter(Number.isInteger(nv) ? nv : parseFloat(nv.toFixed(1))); };
  const toggleItem = (id) => setSelectedItems(prev => prev.includes(id) ? prev.filter(x => x !== id) : [...prev, id]);
  const toggleCategory = (catKey) => setExpandedCategories(prev => ({ ...prev, [catKey]: !prev[catKey] }));
  const toggleProgramming = (pk, ck, iid) => { const np = JSON.parse(JSON.stringify(programming)); if (!np[pk]) np[pk] = {}; if (!np[pk][ck]) np[pk][ck] = []; np[pk][ck] = np[pk][ck].includes(iid) ? np[pk][ck].filter(id => id !== iid) : [...np[pk][ck], iid]; setProgramming(np); };

  const getAvailableItems = () => { if (!selectedPlaceType) return []; const items = []; Object.entries(workItems).forEach(([ck, cat]) => { const eids = programming[selectedPlaceType]?.[ck] || []; cat.items.forEach(i => { if (eids.includes(i.id)) items.push({ ...i, category: cat.name, catKey: ck }); }); }); return items; };

  const addItems = () => { const fa = getArea(), wa = getWallArea(); if (!selectedPlace || fa <= 0 || selectedItems.length === 0) return; const avail = getAvailableItems(); const nai = { ...addedItems }; selectedItems.forEach(id => { const item = avail.find(w => w.id === id); if (!item) return; const isWall = item.type === 'wall' || item.type === 'ceiling'; const finalArea = isWall && wa > 0 ? wa : fa; const key = item.id + '-' + selectedPlace; if (nai[key]) nai[key].area += finalArea; else nai[key] = { ...item, place: selectedPlace, placeType: selectedPlaceType, area: finalArea }; }); setAddedItems(nai); setSelectedItems([]); setArea(0); setLength(0); setWidth(0); };
  const removeAddedItem = (key) => { const n = { ...addedItems }; delete n[key]; setAddedItems(n); };
  const updateAddedItemArea = (key, val) => setAddedItems(p => ({ ...p, [key]: { ...p[key], area: parseFloat(val) || 0 } }));

  const calcTotals = () => { 
    let totalExec = 0, totalCont = 0, totalArea = 0, itemCount = 0;
    Object.values(addedItems).forEach(i => { 
      totalExec += i.area * i.exec; 
      totalCont += i.area * i.cont; 
      totalArea += i.area;
      itemCount++;
    }); 
    const profit = totalExec - totalCont; 
    const profitPercent = totalCont > 0 ? ((profit / totalCont) * 100).toFixed(1) : 0;
    const vatAmount = totalExec * (reportData.vatRate / 100); 
    const grandTotal = totalExec + vatAmount; 
    return { totalExec, totalCont, profit, profitPercent, vatAmount, grandTotal, totalArea, itemCount }; 
  };
  const { totalExec, totalCont, profit, profitPercent, vatAmount, grandTotal, totalArea, itemCount } = calcTotals();
  const canAdd = selectedPlace && getArea() > 0 && selectedItems.length > 0;

  const startEditItem = (catKey, item) => setEditingItem({ catKey, itemId: item.id, name: item.name, desc: item.desc || '', exec: item.exec, cont: item.cont, type: item.type });
  const saveEditItem = () => { if (!editingItem) return; const nw = JSON.parse(JSON.stringify(workItems)); nw[editingItem.catKey].items = nw[editingItem.catKey].items.map(i => i.id === editingItem.itemId ? { ...i, name: editingItem.name, desc: editingItem.desc, exec: editingItem.exec, cont: editingItem.cont, type: editingItem.type } : i); setWorkItems(nw); setEditingItem(null); };
  const deleteItem = (ck, iid) => { const nw = JSON.parse(JSON.stringify(workItems)); nw[ck].items = nw[ck].items.filter(i => i.id !== iid); setWorkItems(nw); const np = JSON.parse(JSON.stringify(programming)); Object.keys(np).forEach(pk => { if (np[pk][ck]) np[pk][ck] = np[pk][ck].filter(id => id !== iid); }); setProgramming(np); if (editingItem?.itemId === iid) setEditingItem(null); };

  const handlePrint = () => window.print();
  const handleImageUpload = (k, e) => { const f = e.target.files[0]; if (f) { const r = new FileReader(); r.onload = (ev) => setImages(p => ({ ...p, [k]: { ...p[k], src: ev.target.result } })); r.readAsDataURL(f); } };
  const updateImageSize = (k, d, v) => setImages(p => ({ ...p, [k]: { ...p[k], [d]: parseInt(v) || 50 } }));
  const removeImage = (k) => { setImages(p => ({ ...p, [k]: { ...p[k], src: null } })); setImageEditModal(null); };
  const updateTerm = (i, v) => { const t = [...reportData.terms]; t[i] = v; setReportData({ ...reportData, terms: t }); };
  const addNewTerm = () => setReportData({ ...reportData, terms: [...reportData.terms, 'Ø´Ø±Ø· Ø¬Ø¯ÙŠØ¯'] });
  const deleteTerm = (i) => setReportData({ ...reportData, terms: reportData.terms.filter((_, idx) => idx !== i) });
  const updateFreeItem = (i, f, v) => { const n = [...freeItems]; n[i][f] = v; setFreeItems(n); };
  const addNewFreeItem = () => setFreeItems([...freeItems, { id: 'F' + (freeItems.length + 1), title: 'Ø®Ø¯Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©', desc: 'ÙˆØµÙ', price: 'Ù…Ø¬Ø§Ù†Ø§Ù‹' }]);
  const deleteFreeItem = (i) => setFreeItems(freeItems.filter((_, idx) => idx !== i));

  const getItemsByCategory = () => { const result = {}; Object.entries(addedItems).forEach(([key, item]) => { if (!result[item.catKey]) result[item.catKey] = { name: item.category, items: [], total: 0 }; const itemTotal = item.area * item.exec; result[item.catKey].items.push({ ...item, key, total: itemTotal }); result[item.catKey].total += itemTotal; }); return result; };

  const noSpinnerStyle = { MozAppearance: 'textfield', WebkitAppearance: 'none', appearance: 'textfield' };
  const cardStyle = { background: c.card, borderRadius: 16, border: '1px solid ' + c.border, padding: 20, marginBottom: 16 };
  const btnStyle = (active) => ({ padding: '12px 20px', borderRadius: 12, border: 'none', background: active ? c.accentGradient : c.cardAlt, color: active ? '#fff' : c.muted, fontSize: 14, fontWeight: 600, cursor: 'pointer', boxShadow: active ? c.accentGlow : 'none', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 8 });
  const inputStyle = { width: '100%', padding: '12px 14px', borderRadius: 10, border: '1px solid ' + c.border, background: c.card, color: c.text, fontSize: 14, outline: 'none', boxSizing: 'border-box', ...noSpinnerStyle };

  const EditableText = ({ value, onChange, style = {}, multiline = false, placeholder = '...' }) => { const [focused, setFocused] = useState(false); const base = { ...style, border: 'none', borderBottom: focused ? '2px solid #0099bb' : '1px solid transparent', background: focused ? '#fffef0' : 'transparent', outline: 'none', fontFamily: 'inherit', padding: '2px 4px', borderRadius: 2, minWidth: 50 }; if (multiline) return <textarea value={value} onChange={(e) => onChange(e.target.value)} onFocus={() => setFocused(true)} onBlur={() => setFocused(false)} placeholder={placeholder} style={{ ...base, resize: 'both', minHeight: 40, width: '100%' }} />; return <input type="text" value={value} onChange={(e) => onChange(e.target.value)} onFocus={() => setFocused(true)} onBlur={() => setFocused(false)} placeholder={placeholder} style={base} />; };

  const EditableImage = ({ imageKey, placeholder }) => { const inputRef = useRef(null); const img = images[imageKey]; return (<div style={{ position: 'relative', display: 'inline-block' }}><input type="file" accept="image/*" onChange={(e) => handleImageUpload(imageKey, e)} ref={inputRef} style={{ display: 'none' }} />{img.src ? (<div style={{ cursor: 'pointer' }} onClick={() => setImageEditModal(imageKey)}><img src={img.src} alt={placeholder} style={{ width: img.width, height: img.height, objectFit: 'contain', borderRadius: 4 }} /><div className="no-print" style={{ position: 'absolute', top: -8, right: -8, background: '#0099bb', color: '#fff', borderRadius: '50%', width: 20, height: 20, display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 10 }}>âœ</div></div>) : (<div onClick={() => inputRef.current?.click()} style={{ width: img.width, height: img.height, background: '#f5f5f5', border: '2px dashed #ccc', borderRadius: 8, display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', cursor: 'pointer', fontSize: 10, color: '#999', gap: 4 }}><Image size={16} />{placeholder}</div>)}</div>); };

  return (
    <div dir="rtl" style={{ color: c.text, padding: 16, background: c.bg, minHeight: '100vh' }}>
      <style>{`
        input, textarea { font-family: inherit; }
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
        @media print { body * { visibility: hidden; } .report-print, .report-print * { visibility: visible; } .report-print { position: absolute; left: 0; top: 0; width: 100%; } .no-print { display: none !important; } }
        .item-row:hover { background: ${c.cardAlt} !important; }
        .delete-btn { opacity: 0; transition: opacity 0.2s; }
        .item-row:hover .delete-btn { opacity: 1; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #000; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #333; }
        * { scrollbar-width: thin; scrollbar-color: #000 transparent; }
      `}</style>
      <div style={{ maxWidth: 1000, margin: '0 auto' }}>
        <div style={{ display: 'flex', alignItems: 'center', gap: 12, marginBottom: 24 }}><div style={{ width: 48, height: 48, borderRadius: 14, background: c.accentGradient, display: 'flex', alignItems: 'center', justifyContent: 'center', boxShadow: c.accentGlow }}><Calculator size={26} color="#fff" /></div><div><h1 style={{ fontSize: 24, fontWeight: 700, margin: 0 }}>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ÙƒÙ…ÙŠØ§Øª</h1><p style={{ fontSize: 14, color: c.muted, margin: 0 }}>Ø§Ø­Ø³Ø¨ ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</p></div></div>

        <div style={cardStyle}><div style={{ display: 'flex', gap: 10 }}><button onClick={() => setMainTab('calculator')} style={{ ...btnStyle(mainTab === 'calculator'), flex: 1 }}><Calculator size={18} /> Ø§Ù„Ø­Ø§Ø³Ø¨Ø©</button><button onClick={() => setMainTab('items')} style={{ ...btnStyle(mainTab === 'items'), flex: 1 }}><Layers size={18} /> Ø§Ù„Ø¨Ù†ÙˆØ¯ ÙˆØ§Ù„Ø¨Ø±Ù…Ø¬Ø©</button></div></div>

        {mainTab === 'calculator' && (<div>
          <div style={cardStyle}>
            <div style={{ fontSize: 14, marginBottom: 12, fontWeight: 600 }}>ğŸ“ Ù†ÙˆØ¹ Ø§Ù„Ù…ÙƒØ§Ù†</div>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: 10, marginBottom: 20 }}>{Object.entries(places).filter(([_, p]) => p.enabled).map(([key, place]) => (<div key={key} onClick={() => { setSelectedPlaceType(key); setSelectedPlace(''); setSelectedItems([]); }} style={{ padding: '18px 14px', borderRadius: 14, border: selectedPlaceType === key ? '2px solid ' + place.color : '1px solid ' + c.border, background: selectedPlaceType === key ? place.color + '18' : c.cardAlt, cursor: 'pointer', textAlign: 'center' }}><div style={{ fontSize: 32, marginBottom: 8 }}>{place.icon}</div><div style={{ fontSize: 14, fontWeight: 600, color: selectedPlaceType === key ? place.color : c.text }}>{place.name}</div></div>))}</div>
            <div style={{ fontSize: 14, marginBottom: 12, fontWeight: 600 }}>ğŸ·ï¸ Ø§Ù„Ù…ÙƒØ§Ù†</div>
            <select value={selectedPlace} onChange={(e) => setSelectedPlace(e.target.value)} disabled={!selectedPlaceType} style={{ ...inputStyle, marginBottom: 20 }}><option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙƒØ§Ù†</option>{selectedPlaceType && calcPlaces[selectedPlaceType]?.map(p => <option key={p} value={p}>{p}</option>)}</select>
            <div style={{ fontSize: 14, marginBottom: 12, fontWeight: 600 }}>ğŸ“ Ø§Ù„Ù…Ø³Ø§Ø­Ø©</div>
            <div style={{ background: c.cardAlt, borderRadius: 14, padding: 18, marginBottom: 20, border: '1px solid ' + c.border }}>
              <div style={{ display: 'flex', gap: 8, marginBottom: 18 }}><button onClick={() => setInputMethod('direct')} style={{ ...btnStyle(inputMethod === 'direct'), flex: 1 }}>Ù…Ø³Ø§Ø­Ø© Ù…Ø¨Ø§Ø´Ø±Ø©</button><button onClick={() => setInputMethod('dimensions')} style={{ ...btnStyle(inputMethod === 'dimensions'), flex: 1 }}>Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„ØºØ±ÙØ©</button></div>
              {inputMethod === 'direct' ? (<div><div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 16, marginBottom: 16 }}><button onClick={() => adjustValue(setArea, area, -1)} style={{ width: 56, height: 56, borderRadius: 14, border: '1px solid ' + c.border, background: c.card, color: c.text, fontSize: 28, cursor: 'pointer' }}>âˆ’</button><div style={{ textAlign: 'center' }}><input type="number" value={area} onChange={(e) => setArea(parseFloat(e.target.value) || 0)} style={{ width: 100, background: 'transparent', border: 'none', color: c.text, fontSize: 42, fontWeight: 700, textAlign: 'center', outline: 'none', ...noSpinnerStyle }} /><div style={{ fontSize: 14, color: c.accent, fontWeight: 600 }}>Ù…Â²</div></div><button onClick={() => adjustValue(setArea, area, 1)} style={{ width: 56, height: 56, borderRadius: 14, border: '1px solid ' + c.border, background: c.card, color: c.text, fontSize: 28, cursor: 'pointer' }}>+</button></div><div style={{ display: 'flex', gap: 8, justifyContent: 'center', flexWrap: 'wrap' }}>{quickAreas.map(val => (<button key={val} onClick={() => setArea(val)} style={{ padding: '10px 18px', borderRadius: 10, border: area === val ? '2px solid ' + c.accent : '1px solid ' + c.border, background: area === val ? c.accent + '20' : c.card, color: area === val ? c.accent : c.text, fontSize: 14, fontWeight: 600, cursor: 'pointer' }}>{val}</button>))}</div></div>) : (<div><div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: 12, marginBottom: 16 }}><div><label style={{ fontSize: 12, color: c.muted, marginBottom: 6, display: 'block' }}>Ø§Ù„Ø·ÙˆÙ„</label><input type="number" value={length} onChange={(e) => setLength(parseFloat(e.target.value) || 0)} style={inputStyle} /></div><div><label style={{ fontSize: 12, color: c.muted, marginBottom: 6, display: 'block' }}>Ø§Ù„Ø¹Ø±Ø¶</label><input type="number" value={width} onChange={(e) => setWidth(parseFloat(e.target.value) || 0)} style={inputStyle} /></div><div><label style={{ fontSize: 12, color: c.muted, marginBottom: 6, display: 'block' }}>Ø§Ù„Ø§Ø±ØªÙØ§Ø¹</label><input type="number" value={height} onChange={(e) => setHeight(parseFloat(e.target.value) || 0)} style={inputStyle} /></div></div><div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 12, padding: 12, background: c.card, borderRadius: 10 }}><div style={{ textAlign: 'center' }}><div style={{ fontSize: 12, color: c.muted }}>Ø£Ø±Ø¶</div><div style={{ fontSize: 20, fontWeight: 700, color: c.success }}>{calcFloorArea().toFixed(1)} Ù…Â²</div></div><div style={{ textAlign: 'center' }}><div style={{ fontSize: 12, color: c.muted }}>Ø¬Ø¯Ø±Ø§Ù†</div><div style={{ fontSize: 20, fontWeight: 700, color: c.info }}>{calcWallArea().toFixed(1)} Ù…Â²</div></div></div></div>)}
            </div>
            <div style={{ fontSize: 14, marginBottom: 12, fontWeight: 600 }}>ğŸ”§ Ø¨Ù†ÙˆØ¯ Ø§Ù„Ø¹Ù…Ù„</div>
            <div style={{ display: 'grid', gap: 8, marginBottom: 16, maxHeight: 250, overflowY: 'auto' }}>{getAvailableItems().map(item => (<div key={item.id} onClick={() => toggleItem(item.id)} style={{ padding: '14px 16px', borderRadius: 12, border: selectedItems.includes(item.id) ? '2px solid ' + c.accent : '1px solid ' + c.border, background: selectedItems.includes(item.id) ? c.accent + '15' : c.cardAlt, cursor: 'pointer', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}><div style={{ display: 'flex', alignItems: 'center', gap: 8 }}><span style={{ fontSize: 14, fontWeight: 600 }}>{item.category} - {item.name}</span><span style={{ fontSize: 11, color: item.type === 'wall' ? c.info : item.type === 'ceiling' ? c.warning : c.success, background: (item.type === 'wall' ? c.info : item.type === 'ceiling' ? c.warning : c.success) + '20', padding: '3px 8px', borderRadius: 6, fontWeight: 600 }}>{item.type === 'wall' ? 'Ø¬Ø¯Ø±Ø§Ù†' : item.type === 'ceiling' ? 'Ø£Ø³Ù‚Ù' : 'Ø£Ø±Ø¶ÙŠØ©'}</span></div><span style={{ fontSize: 13, color: c.muted, background: c.card, padding: '4px 10px', borderRadius: 8, fontWeight: 600 }}>{item.exec} Ø±.Ø³</span></div>))}{getAvailableItems().length === 0 && (<div style={{ textAlign: 'center', padding: '30px 20px', color: c.muted }}><div style={{ fontSize: 32, marginBottom: 8, opacity: 0.4 }}>ğŸ“‹</div><div style={{ fontSize: 13 }}>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…ÙƒØ§Ù†</div></div>)}</div>
            <button onClick={addItems} disabled={!canAdd} style={{ width: '100%', padding: 16, borderRadius: 14, border: 'none', background: canAdd ? c.accentGradient : c.cardAlt, color: canAdd ? '#fff' : c.muted, fontSize: 15, fontWeight: 700, cursor: canAdd ? 'pointer' : 'not-allowed', boxShadow: canAdd ? c.accentGlow : 'none' }}>{selectedItems.length > 0 ? 'â• Ø¥Ø¶Ø§ÙØ© ' + selectedItems.length + ' Ø¨Ù†Ø¯' : 'Ø§Ø®ØªØ± Ø¨Ù†ÙˆØ¯'}</button>
          </div>

          {/* Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„Ù…Ø¶Ø§ÙØ© Ø£ÙˆÙ„Ø§Ù‹ */}
          {Object.keys(addedItems).length > 0 && (<div style={cardStyle}><div style={{ fontSize: 14, marginBottom: 16, fontWeight: 600 }}>ğŸ“‹ Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„Ù…Ø¶Ø§ÙØ© ({itemCount} Ø¨Ù†Ø¯)</div>{Object.entries(getItemsByCategory()).map(([catKey, cat]) => (<div key={catKey} style={{ marginBottom: 16 }}><div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 10 }}><span style={{ fontWeight: 600 }}>{cat.name}</span><span style={{ marginRight: 'auto', fontWeight: 700, color: c.accent }}>{cat.total.toLocaleString()} Ø±.Ø³</span></div>{cat.items.map(item => (<div key={item.key} className="item-row" style={{ display: 'flex', alignItems: 'center', gap: 12, padding: '12px', background: c.cardAlt, borderRadius: 10, marginBottom: 8 }}><div style={{ flex: 1 }}><div style={{ fontWeight: 600, fontSize: 13 }}>{item.name}</div><div style={{ fontSize: 11, color: c.muted }}>{item.place}</div></div><div style={{ display: 'flex', alignItems: 'center', gap: 8 }}><input type="number" value={item.area} onChange={(e) => updateAddedItemArea(item.key, e.target.value)} style={{ width: 60, padding: '6px 8px', borderRadius: 6, border: '1px solid ' + c.border, background: c.card, color: c.text, fontSize: 13, textAlign: 'center', ...noSpinnerStyle }} /><span style={{ fontSize: 11, color: c.muted }}>Ã—</span><span style={{ fontSize: 12, fontWeight: 600 }}>{item.exec}</span><span style={{ fontSize: 11, color: c.muted }}>=</span><span style={{ fontWeight: 700, color: c.accent, minWidth: 70, textAlign: 'left' }}>{item.total.toLocaleString()}</span></div><button onClick={() => removeAddedItem(item.key)} className="delete-btn" style={{ background: '#fee2e2', border: 'none', color: '#dc2626', padding: '6px 8px', borderRadius: 6, cursor: 'pointer' }}><Trash2 size={14} /></button></div>))}</div>))}</div>)}

          {/* Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…ÙØµÙ„ */}
          {Object.keys(addedItems).length > 0 && (<div style={cardStyle}>
            <div style={{ fontSize: 14, fontWeight: 600, marginBottom: 14 }}>ğŸ’° Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</div>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: 12, marginBottom: 16 }}>
              <div style={{ padding: 16, borderRadius: 14, background: c.cardAlt, textAlign: 'center', border: '1px solid ' + c.border }}>
                <div style={{ fontSize: 28, fontWeight: 700, color: c.text }}>{itemCount}</div>
                <div style={{ fontSize: 12, color: c.muted, marginTop: 4 }}>Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ù†ÙˆØ¯</div>
              </div>
              <div style={{ padding: 16, borderRadius: 14, background: c.cardAlt, textAlign: 'center', border: '1px solid ' + c.border }}>
                <div style={{ fontSize: 28, fontWeight: 700, color: c.text }}>{totalArea.toLocaleString()}</div>
                <div style={{ fontSize: 12, color: c.muted, marginTop: 4 }}>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ù…Â²</div>
              </div>
              <div style={{ padding: 16, borderRadius: 14, background: c.success + '15', textAlign: 'center', border: '1px solid ' + c.success + '50' }}>
                <div style={{ fontSize: 28, fontWeight: 700, color: c.success }}>{profitPercent}%</div>
                <div style={{ fontSize: 12, color: c.muted, marginTop: 4 }}>Ù†Ø³Ø¨Ø© Ø§Ù„Ø±Ø¨Ø­</div>
              </div>
            </div>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: 12, marginBottom: 16 }}>
              <div style={{ padding: 18, borderRadius: 14, background: c.warning + '12', textAlign: 'center' }}>
                <div style={{ fontSize: 24, fontWeight: 700, color: c.warning }}>{totalExec.toLocaleString()}</div>
                <div style={{ fontSize: 12, color: c.muted, marginTop: 6 }}>Ø³Ø¹Ø± Ø§Ù„ØªÙ†ÙÙŠØ° (Ù„Ù„Ø¹Ù…ÙŠÙ„)</div>
              </div>
              <div style={{ padding: 18, borderRadius: 14, background: c.info + '12', textAlign: 'center' }}>
                <div style={{ fontSize: 24, fontWeight: 700, color: c.info }}>{totalCont.toLocaleString()}</div>
                <div style={{ fontSize: 12, color: c.muted, marginTop: 6 }}>ØªÙƒÙ„ÙØ© Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„</div>
              </div>
            </div>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: 12 }}>
              <div style={{ padding: 18, borderRadius: 14, background: c.success + '12', textAlign: 'center' }}>
                <div style={{ fontSize: 22, fontWeight: 700, color: c.success }}>{profit.toLocaleString()}</div>
                <div style={{ fontSize: 12, color: c.muted, marginTop: 6 }}>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</div>
              </div>
              <div style={{ padding: 18, borderRadius: 14, background: c.danger + '12', textAlign: 'center' }}>
                <div style={{ fontSize: 22, fontWeight: 700, color: c.danger }}>{vatAmount.toLocaleString()}</div>
                <div style={{ fontSize: 12, color: c.muted, marginTop: 6 }}>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© {reportData.vatRate}%</div>
              </div>
              <div style={{ padding: 18, borderRadius: 14, background: c.accent + '15', textAlign: 'center' }}>
                <div style={{ fontSize: 22, fontWeight: 700, color: c.accent }}>{grandTotal.toLocaleString()}</div>
                <div style={{ fontSize: 12, color: c.muted, marginTop: 6 }}>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø´Ø§Ù…Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</div>
              </div>
            </div>
          </div>)}

          {/* Ø²Ø± Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ */}
          {Object.keys(addedItems).length > 0 && !showReport && (
            <button onClick={() => setShowReport(true)} style={{ width: '100%', padding: 18, borderRadius: 14, border: 'none', background: 'linear-gradient(135deg, #667eea, #764ba2)', color: '#fff', fontSize: 16, fontWeight: 700, cursor: 'pointer', boxShadow: '0 4px 15px rgba(102, 126, 234, 0.4)', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 10, marginBottom: 16 }}>
              <FileText size={22} /> Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙˆØ·Ø¨Ø§Ø¹ØªÙ‡
            </button>
          )}

          {/* Ø§Ù„ØªÙ‚Ø±ÙŠØ± */}
          {showReport && Object.keys(addedItems).length > 0 && (<>
            <div className="no-print" style={{ ...cardStyle, display: 'flex', gap: 8, flexWrap: 'wrap', alignItems: 'center' }}>
              <button onClick={() => setShowReport(false)} style={{ padding: '10px 16px', borderRadius: 8, border: 'none', background: c.danger + '15', color: c.danger, fontWeight: 600, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: 6, fontSize: 13 }}><X size={16} /> Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
              <button onClick={addNewFreeItem} style={{ padding: '10px 16px', borderRadius: 8, border: 'none', background: '#8b5cf6', color: '#fff', fontWeight: 600, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: 6, fontSize: 13 }}><Plus size={16} /> Ø®Ø¯Ù…Ø©</button>
              <button onClick={addNewTerm} style={{ padding: '10px 16px', borderRadius: 8, border: 'none', background: '#f59e0b', color: '#fff', fontWeight: 600, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: 6, fontSize: 13 }}><Plus size={16} /> Ø´Ø±Ø·</button>
              <div style={{ flex: 1 }} />
              <button onClick={handlePrint} style={{ padding: '10px 20px', borderRadius: 8, border: 'none', background: '#667eea', color: '#fff', fontWeight: 600, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: 6, fontSize: 13 }}><Printer size={16} /> Ø·Ø¨Ø§Ø¹Ø©</button>
            </div>
            <div className="no-print" style={{ background: '#e0f2fe', padding: '12px 16px', borderRadius: 8, marginBottom: 16, fontSize: 12, color: '#0369a1' }}>ğŸ’¡ Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠ Ù†Øµ Ù„Ù„ØªØ­Ø±ÙŠØ±</div>
            <div className="report-print" style={{ background: '#fff', borderRadius: 12, overflow: 'hidden', border: '1px solid #e0e0e0', marginBottom: 16 }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', padding: '20px 24px', borderBottom: '1px solid #e0e0e0' }}><div><EditableImage imageKey="logo" placeholder="Ø§Ù„Ø´Ø¹Ø§Ø±" /><div style={{ marginTop: 8 }}><EditableText value={reportData.companyName} onChange={(v) => setReportData({...reportData, companyName: v})} style={{ fontSize: 16, fontWeight: 700, color: '#2d5a3d', display: 'block' }} /><EditableText value={reportData.companySubtitle} onChange={(v) => setReportData({...reportData, companySubtitle: v})} style={{ fontSize: 11, color: '#666' }} /></div></div><div style={{ textAlign: 'center', flex: 1 }}><div style={{ background: '#6b7b3d', color: '#fff', padding: '12px 30px', borderRadius: 25, display: 'inline-block', marginBottom: 12 }}><EditableText value={reportData.headerTitle} onChange={(v) => setReportData({...reportData, headerTitle: v})} style={{ fontSize: 18, fontWeight: 700, color: '#fff', background: 'transparent' }} /></div><div style={{ fontSize: 11, color: '#666', textAlign: 'right' }}><div>Ø±Ù‚Ù…: <EditableText value={reportData.quoteNumber} onChange={(v) => setReportData({...reportData, quoteNumber: v})} style={{ fontWeight: 600 }} /></div><div>Ø§Ù„ØªØ§Ø±ÙŠØ®: <EditableText value={reportData.quoteDate} onChange={(v) => setReportData({...reportData, quoteDate: v})} style={{ fontWeight: 600 }} /></div><div>Ø§Ù„Ù‡Ø§ØªÙ: <EditableText value={reportData.contactPhone} onChange={(v) => setReportData({...reportData, contactPhone: v})} style={{ fontWeight: 600 }} /></div></div></div></div>
              <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', borderBottom: '1px solid #e0e0e0' }}><div style={{ padding: '16px 24px', borderLeft: '1px solid #e0e0e0' }}><div style={{ fontSize: 13, fontWeight: 700, marginBottom: 10 }}>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„:</div><div style={{ fontSize: 12, lineHeight: 2.2 }}><div>Ø§Ù„Ø§Ø³Ù…: <EditableText value={reportData.clientName} onChange={(v) => setReportData({...reportData, clientName: v})} placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„" /></div><div>Ø§Ù„Ù‡Ø§ØªÙ: <EditableText value={reportData.clientPhone} onChange={(v) => setReportData({...reportData, clientPhone: v})} placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" /></div><div>Ø§Ù„Ù…ÙˆÙ‚Ø¹: <EditableText value={reportData.clientLocation} onChange={(v) => setReportData({...reportData, clientLocation: v})} placeholder="Ø§Ù„Ù…ÙˆÙ‚Ø¹" /></div></div></div><div style={{ padding: '16px 24px' }}><div style={{ fontSize: 13, fontWeight: 700, marginBottom: 10 }}>Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©</div><div style={{ fontSize: 11, color: '#666' }}>Ù†Ù‚Ø¯Ù… Ù„ÙƒÙ… Ø¹Ø±Ø¶ Ø³Ø¹Ø± Ù„ØªÙ†ÙÙŠØ° Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</div></div></div>
              <div style={{ background: '#5a6a3a', padding: '14px 24px' }}><EditableText value={reportData.projectTitle} onChange={(v) => setReportData({...reportData, projectTitle: v})} style={{ fontSize: 18, fontWeight: 700, color: '#fff', background: 'transparent' }} /></div>
              <div style={{ display: 'flex' }}><div style={{ flex: 1 }}>{Object.entries(getItemsByCategory()).map(([catKey, cat]) => (<React.Fragment key={catKey}>{cat.items.map((item, idx) => (<div key={item.key} style={{ display: 'flex', borderBottom: '1px solid #eee', background: idx % 2 === 0 ? '#fff' : '#fafafa' }}><div style={{ width: 70, padding: '14px 10px', textAlign: 'center', borderLeft: '1px solid #eee' }}><span style={{ fontSize: 10, fontWeight: 600, color: '#5a6a3a' }}>{item.id}</span></div><div style={{ flex: 1, padding: '14px' }}><div style={{ fontSize: 14, fontWeight: 700, color: '#333', marginBottom: 4 }}>{item.name}</div><div style={{ fontSize: 10, color: '#888' }}>{item.place} â€¢ {item.area} Ù…Â²</div></div><div style={{ width: 100, padding: '14px', textAlign: 'right', borderRight: '1px solid #eee' }}><div style={{ fontSize: 13, fontWeight: 700 }}>{item.total.toLocaleString()}</div><div style={{ fontSize: 9, color: '#888' }}>Ø±ÙŠØ§Ù„</div></div></div>))}</React.Fragment>))}{freeItems.map((item, idx) => (<div key={idx} className="item-row" style={{ display: 'flex', borderBottom: '1px solid #eee', background: '#f0fff0', position: 'relative' }}><button className="delete-btn no-print" onClick={() => deleteFreeItem(idx)} style={{ position: 'absolute', left: 8, top: 8, background: '#fee2e2', border: 'none', color: '#dc2626', cursor: 'pointer', padding: '4px', borderRadius: 4 }}><Trash2 size={12} /></button><div style={{ width: 70, padding: '14px 10px', textAlign: 'center', borderLeft: '1px solid #eee' }}><EditableText value={item.id} onChange={(v) => updateFreeItem(idx, 'id', v)} style={{ fontSize: 10, fontWeight: 600, color: '#5a6a3a' }} /></div><div style={{ flex: 1, padding: '14px' }}><EditableText value={item.title} onChange={(v) => updateFreeItem(idx, 'title', v)} style={{ fontSize: 14, fontWeight: 700, color: '#333', display: 'block', marginBottom: 8 }} /><EditableText value={item.desc} onChange={(v) => updateFreeItem(idx, 'desc', v)} style={{ fontSize: 10, color: '#666' }} /></div><div style={{ width: 100, padding: '14px', textAlign: 'right', borderRight: '1px solid #eee' }}><EditableText value={item.price} onChange={(v) => updateFreeItem(idx, 'price', v)} style={{ fontSize: 13, fontWeight: 700, color: '#16a34a' }} /></div></div>))}</div><div style={{ width: 100, background: '#f8f8f8', borderRight: '2px solid #5a6a3a', padding: '20px 10px', display: 'flex', flexDirection: 'column', justifyContent: 'center', alignItems: 'center' }}><div style={{ fontSize: 11, color: '#888', marginBottom: 6 }}>Ø±ÙŠØ§Ù„</div><div style={{ fontSize: 18, fontWeight: 700, color: '#333' }}>{totalExec.toLocaleString()}</div></div></div>
              <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', borderTop: '3px solid #5a6a3a' }}><div style={{ padding: '20px 24px', borderLeft: '1px solid #e0e0e0' }}><div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 10, fontSize: 12 }}><span style={{ fontWeight: 600 }}>{totalExec.toLocaleString()}</span><span style={{ color: '#888' }}>Ø§Ù„Ù…Ø¨Ù„Øº</span></div><div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 10, fontSize: 12 }}><span style={{ fontWeight: 600 }}>{vatAmount.toLocaleString()}</span><span style={{ color: '#888' }}>Ø¶Ø±ÙŠØ¨Ø© ({reportData.vatRate}%)</span></div><div style={{ display: 'flex', justifyContent: 'space-between', paddingTop: 12, borderTop: '2px solid #5a6a3a', fontSize: 14 }}><span style={{ fontWeight: 700, color: '#5a6a3a', fontSize: 16 }}>{grandTotal.toLocaleString()} Ø±ÙŠØ§Ù„</span><span style={{ fontWeight: 700 }}>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span></div></div><div style={{ padding: '20px 24px' }}><div style={{ fontSize: 12, fontWeight: 700, marginBottom: 10, color: '#92400e' }}>ğŸ“Œ Ù…Ù„Ø§Ø­Ø¸Ø©:</div><div style={{ background: '#fef3c7', padding: 12, borderRadius: 8 }}><EditableText value={reportData.noteText} onChange={(v) => setReportData({...reportData, noteText: v})} multiline style={{ fontSize: 10, color: '#92400e', width: '100%' }} /></div></div></div>
              <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', borderTop: '1px solid #e0e0e0' }}><div style={{ padding: '20px 24px', borderLeft: '1px solid #e0e0e0' }}><div style={{ fontSize: 12, fontWeight: 700, marginBottom: 12 }}>ğŸ“‹ Ø§Ù„Ø´Ø±ÙˆØ·:</div><ul style={{ fontSize: 10, color: '#666', paddingRight: 18, margin: 0, lineHeight: 2 }}>{reportData.terms.map((t, i) => (<li key={i} className="item-row" style={{ position: 'relative' }}><EditableText value={t} onChange={(v) => updateTerm(i, v)} style={{ width: '90%' }} /><button className="delete-btn no-print" onClick={() => deleteTerm(i)} style={{ position: 'absolute', left: 0, top: 0, background: 'none', border: 'none', color: '#dc2626', cursor: 'pointer', fontSize: 10 }}>âœ•</button></li>))}</ul></div><div style={{ padding: '20px 24px' }}><div style={{ fontSize: 12, fontWeight: 700, marginBottom: 12, color: '#5a6a3a' }}>ğŸ¦ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„</div><div style={{ fontSize: 11, lineHeight: 2.2 }}><div>Ø§Ù„Ø¨Ù†Ùƒ: <EditableText value={reportData.bankName} onChange={(v) => setReportData({...reportData, bankName: v})} /></div><div>Ø§Ù„Ø­Ø³Ø§Ø¨: <EditableText value={reportData.accountNumber} onChange={(v) => setReportData({...reportData, accountNumber: v})} placeholder="Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨" /></div><div>Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†: <EditableText value={reportData.iban} onChange={(v) => setReportData({...reportData, iban: v})} placeholder="Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†" /></div></div><div style={{ marginTop: 20, display: 'flex', alignItems: 'center', gap: 16, justifyContent: 'flex-end' }}><EditableImage imageKey="stamp" placeholder="Ø§Ù„Ø®ØªÙ…" /><EditableImage imageKey="signature" placeholder="Ø§Ù„ØªÙˆÙ‚ÙŠØ¹" /></div></div></div>
              <div style={{ background: '#5a6a3a', padding: '12px 24px', textAlign: 'center' }}><EditableText value={reportData.footerEmail} onChange={(v) => setReportData({...reportData, footerEmail: v})} style={{ fontSize: 12, color: '#fff', background: 'transparent' }} /></div>
            </div>
          </>)}
        </div>)}

        {mainTab === 'items' && (<div>
          <div style={cardStyle}><div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 16 }}><h3 style={{ fontSize: 16, fontWeight: 700, margin: 0, display: 'flex', alignItems: 'center', gap: 8 }}><Settings size={20} /> Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ù…Ø§ÙƒÙ†</h3></div><div style={{ display: 'flex', gap: 10, flexWrap: 'wrap' }}>{Object.entries(places).map(([pk, place]) => (<div key={pk} onClick={() => setPlaces(p => ({ ...p, [pk]: { ...p[pk], enabled: !p[pk].enabled } }))} style={{ padding: '12px 16px', borderRadius: 12, background: place.enabled ? place.color + '15' : c.cardAlt, border: '1px solid ' + (place.enabled ? place.color : c.border), display: 'flex', alignItems: 'center', gap: 10, opacity: place.enabled ? 1 : 0.5, cursor: 'pointer' }}><span style={{ fontSize: 20 }}>{place.icon}</span><span style={{ fontSize: 14, fontWeight: 600, color: place.enabled ? place.color : c.muted }}>{place.name}</span><div style={{ width: 40, height: 22, borderRadius: 11, background: place.enabled ? place.color : c.border, position: 'relative' }}><div style={{ width: 18, height: 18, borderRadius: '50%', background: '#fff', position: 'absolute', top: 2, right: place.enabled ? 2 : 20, transition: 'right 0.2s' }} /></div></div>))}</div></div>
          <div style={cardStyle}><div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 16 }}><h3 style={{ fontSize: 16, fontWeight: 700, margin: 0, display: 'flex', alignItems: 'center', gap: 8 }}><Layers size={20} /> Ø§Ù„Ø¨Ù†ÙˆØ¯ ÙˆØ§Ù„Ø£Ø³Ø¹Ø§Ø±</h3></div><div style={{ display: 'grid', gap: 10 }}>{Object.entries(workItems).map(([catKey, cat]) => (<div key={catKey} style={{ background: c.cardAlt, borderRadius: 14, border: '1px solid ' + c.border, overflow: 'hidden' }}><button onClick={() => toggleCategory(catKey)} style={{ width: '100%', padding: '16px 18px', border: 'none', background: expandedCategories[catKey] ? c.accent + '10' : 'transparent', color: c.text, fontSize: 15, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: 12, textAlign: 'right' }}><span style={{ fontSize: 24 }}>{cat.icon}</span><span style={{ flex: 1, fontWeight: 700 }}>{cat.name}</span><span style={{ fontSize: 12, color: c.muted, background: c.card, padding: '4px 12px', borderRadius: 8 }}>{cat.items.length} Ø¨Ù†Ø¯</span>{expandedCategories[catKey] ? <ChevronUp size={20} color={c.muted} /> : <ChevronDown size={20} color={c.muted} />}</button>{expandedCategories[catKey] && (<div style={{ padding: '12px 16px', borderTop: '1px solid ' + c.border }}>{cat.items.map(item => { const isEditing = editingItem?.catKey === catKey && editingItem?.itemId === item.id; const typeColor = item.type === 'floor' ? c.success : item.type === 'wall' ? c.info : c.warning; return (<div key={item.id} style={{ padding: 16, background: isEditing ? c.accent + '10' : c.card, borderRadius: 12, border: '1px solid ' + (isEditing ? c.accent : c.border), marginBottom: 10 }}>{isEditing ? (<div><div style={{ display: 'grid', gap: 12, marginBottom: 12 }}><div><label style={{ fontSize: 12, color: c.muted, marginBottom: 6, display: 'block' }}>Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ø¯</label><input type="text" value={editingItem.name} onChange={(e) => setEditingItem({ ...editingItem, name: e.target.value })} style={inputStyle} /></div><div><label style={{ fontSize: 12, color: c.muted, marginBottom: 6, display: 'block' }}>Ø§Ù„ÙˆØµÙ</label><textarea value={editingItem.desc} onChange={(e) => setEditingItem({ ...editingItem, desc: e.target.value })} style={{ ...inputStyle, minHeight: 60, resize: 'vertical' }} /></div><div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: 10 }}><div><label style={{ fontSize: 12, color: c.warning, marginBottom: 6, display: 'block' }}>Ø³Ø¹Ø± Ø§Ù„ØªÙ†ÙÙŠØ°</label><input type="number" value={editingItem.exec} onChange={(e) => setEditingItem({ ...editingItem, exec: parseFloat(e.target.value) || 0 })} style={{ ...inputStyle, borderColor: c.warning, color: c.warning, fontWeight: 700 }} /></div><div><label style={{ fontSize: 12, color: c.info, marginBottom: 6, display: 'block' }}>Ø³Ø¹Ø± Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„</label><input type="number" value={editingItem.cont} onChange={(e) => setEditingItem({ ...editingItem, cont: parseFloat(e.target.value) || 0 })} style={{ ...inputStyle, borderColor: c.info, color: c.info, fontWeight: 700 }} /></div><div><label style={{ fontSize: 12, color: c.success, marginBottom: 6, display: 'block' }}>Ø§Ù„Ø±Ø¨Ø­</label><div style={{ ...inputStyle, background: c.success + '15', color: c.success, fontWeight: 700, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>{editingItem.exec - editingItem.cont}</div></div></div><div><label style={{ fontSize: 12, color: c.muted, marginBottom: 6, display: 'block' }}>Ù†ÙˆØ¹ Ø§Ù„Ø¨Ù†Ø¯</label><div style={{ display: 'flex', gap: 8 }}>{[{ k: 'floor', l: 'Ø£Ø±Ø¶ÙŠØ©', col: c.success }, { k: 'wall', l: 'Ø¬Ø¯Ø±Ø§Ù†', col: c.info }, { k: 'ceiling', l: 'Ø£Ø³Ù‚Ù', col: c.warning }].map(ty => (<button key={ty.k} onClick={() => setEditingItem({ ...editingItem, type: ty.k })} style={{ flex: 1, padding: 10, borderRadius: 8, border: editingItem.type === ty.k ? '2px solid ' + ty.col : '1px solid ' + c.border, background: editingItem.type === ty.k ? ty.col + '15' : 'transparent', color: editingItem.type === ty.k ? ty.col : c.muted, fontSize: 13, cursor: 'pointer', fontWeight: 600 }}>{ty.l}</button>))}</div></div></div><div style={{ display: 'flex', gap: 8, justifyContent: 'flex-end' }}><button onClick={() => deleteItem(catKey, item.id)} style={{ padding: '8px 14px', borderRadius: 8, border: 'none', background: c.danger + '15', color: c.danger, fontSize: 13, cursor: 'pointer', fontWeight: 600, display: 'flex', alignItems: 'center', gap: 4 }}><Trash2 size={14} /> Ø­Ø°Ù</button><button onClick={() => setEditingItem(null)} style={{ padding: '8px 14px', borderRadius: 8, border: '1px solid ' + c.border, background: 'transparent', color: c.muted, fontSize: 13, cursor: 'pointer', fontWeight: 600 }}>Ø¥Ù„ØºØ§Ø¡</button><button onClick={saveEditItem} style={{ padding: '8px 16px', borderRadius: 8, border: 'none', background: c.accentGradient, color: '#fff', fontSize: 13, cursor: 'pointer', fontWeight: 600, display: 'flex', alignItems: 'center', gap: 4 }}><Save size={14} /> Ø­ÙØ¸</button></div></div>) : (<div><div style={{ display: 'flex', alignItems: 'flex-start', gap: 12, marginBottom: 12 }}><div style={{ flex: 1 }}><div style={{ fontSize: 15, fontWeight: 700, marginBottom: 4 }}>{item.name}</div>{item.desc && <div style={{ fontSize: 12, color: c.muted }}>{item.desc}</div>}</div><button onClick={() => startEditItem(catKey, item)} style={{ width: 32, height: 32, borderRadius: 8, border: 'none', background: c.accent + '15', color: c.accent, cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center' }}><Edit3 size={16} /></button></div><div style={{ display: 'flex', alignItems: 'center', gap: 8, flexWrap: 'wrap', marginBottom: 12 }}><span style={{ fontSize: 11, color: typeColor, background: typeColor + '15', padding: '4px 10px', borderRadius: 6, fontWeight: 600 }}>{item.type === 'floor' ? 'Ø£Ø±Ø¶ÙŠØ©' : item.type === 'wall' ? 'Ø¬Ø¯Ø±Ø§Ù†' : 'Ø£Ø³Ù‚Ù'}</span><span style={{ fontSize: 11, color: c.warning, background: c.warning + '15', padding: '4px 10px', borderRadius: 6, fontWeight: 600 }}>ØªÙ†ÙÙŠØ°: {item.exec}</span><span style={{ fontSize: 11, color: c.info, background: c.info + '15', padding: '4px 10px', borderRadius: 6, fontWeight: 600 }}>Ù…Ù‚Ø§ÙˆÙ„: {item.cont}</span><span style={{ fontSize: 11, color: c.success, background: c.success + '15', padding: '4px 10px', borderRadius: 6, fontWeight: 600 }}>Ø±Ø¨Ø­: {item.exec - item.cont}</span></div><div style={{ display: 'flex', alignItems: 'center', gap: 8, flexWrap: 'wrap' }}><span style={{ fontSize: 12, color: c.muted }}>Ù…ØªØ§Ø­ ÙÙŠ:</span>{Object.entries(places).map(([pk, place]) => { const isEnabled = programming[pk]?.[catKey]?.includes(item.id); return (<button key={pk} onClick={() => toggleProgramming(pk, catKey, item.id)} style={{ display: 'flex', alignItems: 'center', gap: 4, padding: '5px 10px', borderRadius: 8, border: '1px solid ' + (isEnabled ? place.color : c.border), background: isEnabled ? place.color + '15' : 'transparent', color: isEnabled ? place.color : c.muted, fontSize: 11, cursor: 'pointer', fontWeight: 600 }}>{isEnabled && <Check size={12} />}<span>{place.icon}</span><span>{place.name}</span></button>); })}</div></div>)}</div>); })}</div>)}</div>))}</div></div>
        </div>)}
      </div>
      {imageEditModal && (<div className="no-print" style={{ position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.8)', zIndex: 1000, display: 'flex', alignItems: 'center', justifyContent: 'center' }}><div style={{ background: '#fff', borderRadius: 16, padding: 24, maxWidth: 400, width: '90%' }}><div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 20 }}><h3 style={{ margin: 0, fontSize: 16 }}>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©</h3><button onClick={() => setImageEditModal(null)} style={{ background: 'none', border: 'none', cursor: 'pointer', fontSize: 20 }}>âœ•</button></div>{images[imageEditModal]?.src && (<div style={{ textAlign: 'center', marginBottom: 20 }}><img src={images[imageEditModal].src} alt="" style={{ maxWidth: '100%', maxHeight: 150, objectFit: 'contain' }} /></div>)}<div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 12, marginBottom: 20 }}><div><label style={{ fontSize: 12, color: '#666', display: 'block', marginBottom: 4 }}>Ø§Ù„Ø¹Ø±Ø¶</label><input type="number" value={images[imageEditModal]?.width || 80} onChange={(e) => updateImageSize(imageEditModal, 'width', e.target.value)} style={{ width: '100%', padding: '10px', borderRadius: 8, border: '1px solid #ddd', fontSize: 14 }} /></div><div><label style={{ fontSize: 12, color: '#666', display: 'block', marginBottom: 4 }}>Ø§Ù„Ø§Ø±ØªÙØ§Ø¹</label><input type="number" value={images[imageEditModal]?.height || 60} onChange={(e) => updateImageSize(imageEditModal, 'height', e.target.value)} style={{ width: '100%', padding: '10px', borderRadius: 8, border: '1px solid #ddd', fontSize: 14 }} /></div></div><div style={{ display: 'flex', gap: 10 }}><button onClick={() => { const input = document.createElement('input'); input.type = 'file'; input.accept = 'image/*'; input.onchange = (e) => handleImageUpload(imageEditModal, e); input.click(); }} style={{ flex: 1, padding: '12px', borderRadius: 8, border: 'none', background: '#0099bb', color: '#fff', fontWeight: 600, cursor: 'pointer' }}>ØªØºÙŠÙŠØ±</button><button onClick={() => removeImage(imageEditModal)} style={{ padding: '12px 20px', borderRadius: 8, border: 'none', background: '#fee2e2', color: '#dc2626', fontWeight: 600, cursor: 'pointer' }}>Ø­Ø°Ù</button></div></div></div>)}
    </div>
  );
};

export default QuantityCalculator;
Items: 'center', gap: 4, padding: '5px 10px', borderRadius: 8, border: '1px solid ' + (isEnabled ? place.color : c.border), background: isEnabled ? place.color + '15' : 'transparent', color: isEnabled ? place.color : c.muted, fontSize: 11, cursor: 'pointer', fontWeight: 600 }}>{isEnabled && <Check size={12} />}<span>{place.icon}</span><span>{place.name}</span></button>); })}</div></div>)}</div>); })}</div>)}</div>))}</div></div>
        </div>)}
      </div>
      {imageEditModal && (<div className="no-print" style={{ position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.8)', zIndex: 1000, display: 'flex', alignItems: 'center', justifyContent: 'center' }}><div style={{ background: '#fff', borderRadius: 16, padding: 24, maxWidth: 400, width: '90%' }}><div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 20 }}><h3 style={{ margin: 0, fontSize: 16 }}>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©</h3><button onClick={() => setImageEditModal(null)} style={{ background: 'none', border: 'none', cursor: 'pointer', fontSize: 20 }}>âœ•</button></div>{images[imageEditModal]?.src && (<div style={{ textAlign: 'center', marginBottom: 20 }}><img src={images[imageEditModal].src} alt="" style={{ maxWidth: '100%', maxHeight: 150, objectFit: 'contain' }} /></div>)}<div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 12, marginBottom: 20 }}><div><label style={{ fontSize: 12, color: '#666', display: 'block', marginBottom: 4 }}>Ø§Ù„Ø¹Ø±Ø¶</label><input type="number" value={images[imageEditModal]?.width || 80} onFocus={handleInputFocus} onChange={(e) => updateImageSize(imageEditModal, 'width', e.target.value)} style={{ width: '100%', padding: '10px', borderRadius: 8, border: '1px solid #ddd', fontSize: 14 }} /></div><div><label style={{ fontSize: 12, color: '#666', display: 'block', marginBottom: 4 }}>Ø§Ù„Ø§Ø±ØªÙØ§Ø¹</label><input type="number" value={images[imageEditModal]?.height || 60} onFocus={handleInputFocus} onChange={(e) => updateImageSize(imageEditModal, 'height', e.target.value)} style={{ width: '100%', padding: '10px', borderRadius: 8, border: '1px solid #ddd', fontSize: 14 }} /></div></div><div style={{ display: 'flex', gap: 10 }}><button onClick={() => { const input = document.createElement('input'); input.type = 'file'; input.accept = 'image/*'; input.onchange = (e) => handleImageUpload(imageEditModal, e); input.click(); }} style={{ flex: 1, padding: '12px', borderRadius: 8, border: 'none', background: '#0099bb', color: '#fff', fontWeight: 600, cursor: 'pointer' }}>ØªØºÙŠÙŠØ±</button><button onClick={() => removeImage(imageEditModal)} style={{ padding: '12px 20px', borderRadius: 8, border: 'none', background: '#fee2e2', color: '#dc2626', fontWeight: 600, cursor: 'pointer' }}>Ø­Ø°Ù</button></div></div></div>)}
    </div>
  );
};

export default QuantityCalculator;
